<div class="center">
  <app-upload></app-upload>
<mat-card *ngFor="let poll of polls ; let poll_i = index;" class="poll-card">
    <mat-card-title>{{poll.title}}</mat-card-title>
    <mat-card-subtitle *ngIf="!votes[poll_i].isValid"><mat-error>Uzupełnij pole</mat-error></mat-card-subtitle>
<mat-card-content>
<mat-accordion>
        <mat-expansion-panel *ngFor="let question of poll.questions; let question_i = index;let question_first = first; let question_last = last"
          [expanded]="question_i === accordionStates[poll_i]"
           (opened)="setQuestion(poll_i, question_i)">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{question.question}}
            </mat-panel-title>
            <mat-panel-description>
                <mat-error *ngIf="!votes[poll_i].questions[question_i].isValid">Uzupełnij pole</mat-error>
            </mat-panel-description>
          </mat-expansion-panel-header>
            <mat-radio-group *ngIf="question.type == 'single'"
                class="radio-group" (change) = "handleSingleAnswerChange(poll_i,question_i,$event)">
                <mat-radio-button class="radio-button" [value]="answer.slug" *ngFor="let answer of question.answers">
                {{answer.answer}}
                </mat-radio-button>
            </mat-radio-group>

            <div class="radio-group" *ngIf="question.type == 'multi'">
                <mat-slide-toggle  class="radio-button" *ngFor="let answer of question.answers" (change) = "handleMultiAnswerChange(poll_i,question_i,$event,answer.slug)" >{{answer.answer}}</mat-slide-toggle>
            </div>
            <mat-action-row>
                <button *ngIf="question_last" mat-flat-button color="primary" (click)='openSummary(poll_i)'>Głosuj</button> 
                <span style="flex: 1 1 auto;"></span>
                <button *ngIf="!question_first" mat-button color="warn" (click)="prevQuestion(poll_i,question_i)">Poprzednie</button>
                <button *ngIf="!question_last" mat-button color="primary" (click)="nextQuestion(poll_i,question_i)">Następne</button>
              </mat-action-row>
        </mat-expansion-panel>
   
</mat-accordion>
</mat-card-content>
  <mat-card-actions>
    <button mat-button color="primary"   [routerLink]="['/results',poll.slug]"  >Wyniki</button>
  </mat-card-actions>
</mat-card>
</div>

